#Based on Sophos Firewall 17.5+
#Rule version 1.0.0

- name: "Probable malware detected by sophos firewall"
  severity: "High"
  description: "The Sophos firewall has detected a suspicious event and made some actions according to his configuration"
  solution: "Check the logs to define if it is a real virus or a false positive"
  category: "Malware"
  tactic: ""
  dataTypes: ["firewall-sophos-xg"]
  reference: 
    - "https://www.mcafee.com/en-us/antivirus/malware.html"
    - "https://www.fortinet.com/resources/cyberglossary/computer-virus"
  frequency: 60
  cache:
    - oneOf:
        - field: "logx.sophos.log_subtype"
          operator: "regexp"
          value: "^((V|v)irus|PUA)$"
      minCount: 1
      timeLapse: 60
      save:
        - field: "logx.sophos.proto"
          alias: "Protocol"
        - field: "logx.sophos.user_name"
          alias: "SourceUser"
        - field: "logx.sophos.src_ip"
          alias: "SourceIP"
        - field: "logx.sophos.src_port"
          alias: "SourcePort"
        - field: "logx.sophos.dest_ip"
          alias: "DestinationIP"
        - field: "logx.sophos.dest_port"
          alias: "DestinationPort"
        - field: logx.sophos.src_host
          alias: "SourceHost"
