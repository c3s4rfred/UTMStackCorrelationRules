# Rule version v1.0.2

- name: "Windows Defender: Antimalware platform is expired due to error"
  severity: "Medium"
  description: "This rule is triggered when the system detects that the antimalware platform has expired due to an error or problem. 
                This alert is essential to identify situations where the anti-malware platform is no longer up to date or cannot function properly due to an error, 
                which can leave the system vulnerable to security threats."
  solution: "Given the generation of this alert, it is crucial to address the cause of the expiration of the antimalware platform. 
            Verify if the platform license is current and if a renewal is required. 
            Investigate the specific bug or issue that caused the expiration and take any necessary corrective action to restore the antimalware platform to a functional state. 
            It is important to ensure that you keep your virus definitions and anti-malware engine up to date, as well as resolve any issues that may affect the proper functioning of the security platform."
  category: "Defense Evasion"
  tactic: "Impair Defenses"
  dataTypes: ["wineventlog"]
  reference: 
    - "https://attack.mitre.org/tactics/TA0005/"
    - "https://attack.mitre.org/techniques/T1562/"
  frequency: 60
  cache:
    - allOf:
        - field: "logx.wineventlog.event.provide"
          operator: "=="
          value: "SecurityCenter"
        - field: "logx.wineventlog.event_id"
          operator: "=="
          value: 5101
      timeLapse: 60
      minCount: 1
      save:
        - field: "logx.wineventlog.event_data.SubjectUserName"
          alias: "SourceUser"
        - field: "logx.wineventlog.host.name"
          alias: "SourceHost"
        - field: "logx.wineventlog.host.ip.1"
          alias: "SourceIP"
        - field: "logx.wineventlog.event_data.IpPort"
          alias: "SourcePort"
        - field: "logx.wineventlog.event_data.TargetUserName"
          alias: "DestinationUser"
