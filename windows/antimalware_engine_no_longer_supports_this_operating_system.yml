# Rule version v1.0.2

- name: "Windows Defender: Antimalware engine no longer supports this Operating System"
  severity: "Medium"
  description: "This rule is triggered when the antimalware engine detects that the operating system is not compatible with the current version of the antimalware engine. 
                This alert is crucial to identify a situation where the antimalware engine can no longer provide effective protection due to incompatibility with the operating system, 
                which can leave the system vulnerable to security threats."
  solution: "When this alert is generated, immediate action must be taken to guarantee the continuity of antivirus protection. 
            Check if the operating system is compatible with the current version of the antimalware engine and, if necessary, update or change the engine to make it compatible. 
            Also, be sure to keep your security software, including virus definitions and anti-malware engine, up-to-date to ensure continuous and effective protection against security threats."
  category: "Defense Evasion"
  tactic: "Impair Defenses"
  dataTypes: ["wineventlog"]
  reference: 
    - "https://attack.mitre.org/tactics/TA0005/"
    - "https://attack.mitre.org/techniques/T1562/"
  frequency: 60
  cache:
    - allOf:
        - field: "logx.wineventlog.event.provide"
          operator: "=="
          value: "SecurityCenter"
        - field: "logx.wineventlog.event_id"
          operator: "=="
          value: 2042,2041
      timeLapse: 60
      minCount: 1
      save:
        - field: "logx.wineventlog.event_data.SubjectUserName"
          alias: "SourceUser"
        - field: "logx.wineventlog.host.name"
          alias: "SourceHost"
        - field: "logx.wineventlog.host.ip.1"
          alias: "SourceIP"
        - field: "logx.wineventlog.event_data.IpPort"
          alias: "SourcePort"
        - field: "logx.wineventlog.event_data.TargetUserName"
          alias: "DestinationUser"
