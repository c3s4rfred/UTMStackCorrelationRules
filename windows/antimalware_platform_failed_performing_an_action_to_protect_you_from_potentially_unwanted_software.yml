# Rule version v1.0.2

- name: "Windows Defender: Antimalware platform failed performing an action to protect you from potentially unwanted software"
  severity: "High"
  description: "This rule is triggered when the system detects that the antimalware platform has experienced a failure or error while trying to perform a protection action against potentially unwanted software. 
                This alert is essential to identify situations where the system could not be adequately protected against unwanted software, which can increase the risk of infections and compromise system security."
  solution: "Given the generation of this alert, it is essential to investigate and address the cause of the failure of the antimalware platform. Review the event logs and details associated with the error to identify the root of the problem. 
            Take the necessary steps to resolve the failure, which may include updating security software, correcting misconfigurations, or applying patches. It is important to ensure that the anti-malware platform is working properly to ensure continuous and effective protection against potentially unwanted software."
  category: "Defense Evasion"
  tactic: "Impair Defenses"
  dataTypes: ["wineventlog"]
  reference: 
    - "https://attack.mitre.org/tactics/TA0005/"
    - "https://attack.mitre.org/techniques/T1562/"
  frequency: 60
  cache:
    - allOf:
        - field: "logx.wineventlog.event.provide"
          operator: "=="
          value: "SecurityCenter"
        - field: "logx.wineventlog.event_id"
          operator: "in"
          value: 1118,1119
      timeLapse: 60
      minCount: 1
      save:
        - field: "logx.wineventlog.event_data.SubjectUserName"
          alias: "SourceUser"
        - field: "logx.wineventlog.host.name"
          alias: "SourceHost"
        - field: "logx.wineventlog.host.ip.1"
          alias: "SourceIP"
        - field: "logx.wineventlog.event_data.IpPort"
          alias: "SourcePort"
        - field: "logx.wineventlog.event_data.TargetUserName"
          alias: "DestinationUser"
