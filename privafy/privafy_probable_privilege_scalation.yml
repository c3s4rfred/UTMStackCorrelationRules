# Based on Privafy POC documentation
# Rule version v1.0.0

- name: "Privafy: Problable privilege escalation"
  severity: "High"
  description: "Adversaries may manipulate accounts to maintain and/or elevate access to victim systems. 
                Account manipulation may consist of any action that preserves or modifies adversary access to a compromised 
                account, such as modifying credentials or permission groups. These actions could also include account activity 
                designed to subvert security policies, such as performing iterative password updates to bypass password duration 
                policies and preserve the life of compromised credentials."
  solution: "<ol>
    <li>Contact the Privafy provider for further information.</li>
    </ol>"
  category: "Privilege Escalation"
  tactic: "Account Manipulation"
  dataTypes: ["privafy"]
  reference: 
    - "https://attack.mitre.org/tactics/TA0004"
    - "https://attack.mitre.org/techniques/T1098"
  frequency: 60
  cache:
    - allOf:
        - field: "logx.privafy.embEventClassID"
          operator: "=="
          value: "4672"
        - field: "logx.privafy.embDeviceProduct"
          operator: "=="
          value: "EDR"
        - field: "logx.privafy.embName"
          operator: "start with"
          value: "Special admin privilege assigned to new logon"
      minCount: 1
      timeLapse: 60
      save:
        - field: "logx.privafy.proto"
          alias: "Protocol"
        - field: "logx.privafy.src_user"
          alias: "SourceUser"
        - field: "logx.privafy.src_ip"
          alias: "SourceIP"
        - field: "logx.privafy.src_port"
          alias: "SourcePort"
        - field: "logx.privafy.dest_ip"
          alias: "DestinationIP"
        - field: "logx.privafy.dest_port"
          alias: "DestinationPort"
        - field: logx.privafy.src_host
          alias: "SourceHost"
